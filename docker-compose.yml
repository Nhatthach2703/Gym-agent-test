services:
  gym-agent:
    image: python:3.10-slim
    container_name: gym-agent-test-app
    working_dir: /app
    env_file:
      - ./.env
    environment:
      - POETRY_HOME=/opt/poetry
      - POETRY_VIRTUALENVS_IN_PROJECT=true
      - POETRY_NO_INTERACTION=1
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
    volumes:
      - ./:/app
      - poetry_cache:/root/.cache/pypoetry
      - pip_cache:/root/.cache/pip
      - venv_data:/app/.venv
    command: >
      bash -lc "
      apt-get update &&
      apt-get install -y --no-install-recommends curl git && 
      curl -sSL https://install.python-poetry.org | python3 - &&
      /opt/poetry/bin/poetry --version &&
      /opt/poetry/bin/poetry install &&
      /opt/poetry/bin/poetry run python src/gym_agent_test/main_RAG.py
      "
    tty: true
    stdin_open: true

  husky:
    image: node:20-alpine
    container_name: gym-agent-test-husky
    working_dir: /app
    command: sh -c "npm ci || npm install && tail -f /dev/null"
    volumes:
      - ./:/app
      - node_modules_cache:/app/node_modules
    profiles:
      - tools

volumes:
  poetry_cache:
  pip_cache:
  venv_data:
  node_modules_cache:


